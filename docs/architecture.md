# Architecture

The agent maintains a persistent and reliable connection to the remote server:

- **Automatic reconnection**: Implements exponential backoff when connections fail
- **Connection health monitoring**: Actively checks connection health
- **Graceful recovery**: Handles network interruptions seamlessly
- **TCP/TLS tunneling**: Proxies traffic between local applications and remote services with optional TLS support

## Design Principles

- Separation of concerns with focused packages
- Dependency injection via interfaces
- Context propagation for cancellation
- Proper resource cleanup
- Testable code with autogenerated mocks
- Small, focused interfaces

## Project Structure

```
├── cmd/amaru_agent/     # Main entry point
├── internal/            # Internal packages
│   ├── app/             # Application core
│   ├── config/          # Configuration
│   ├── daemon/          # Background process
│   ├── event/           # Event pub/sub system
│   ├── i18n/            # Internationalization
│   ├── protocol/        # Communication protocol
│   ├── registry/        # Transport registration
│   ├── service/         # Business logic
│   ├── ssh/             # SSH connection implementation
│   ├── transport/       # Connection interfaces and abstractions
│   └── util/            # Shared utilities
├── Makefile             # Build automation
└── config.toml          # Default config
```

## Dependencies

- `github.com/BurntSushi/toml` - TOML configuration
- `golang.org/x/crypto/ssh` - Connection functionality
- `github.com/nicksnyder/go-i18n/v2` - Internationalization
- `golang.org/x/text` - Language detection
- `github.com/maniartech/signals` - Event handling system
- `go.uber.org/mock` - Mock generation for testing
